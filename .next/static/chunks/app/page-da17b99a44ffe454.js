(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2148:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var l=s(5155),r=s(2115),a=s(7309),n=s(6766),i=s(6126);let c=e=>{let{onClose:t}=e,[s,c]=(0,r.useState)(0),o=e=>{"LEFT"===e?c(e=>(e+1)%2):"RIGHT"===e&&c(e=>(e-1+2)%2)},d=(0,a.uh)({onSwipedLeft:()=>o("LEFT"),onSwipedRight:()=>o("RIGHT"),preventScrollOnSwipe:!0,trackMouse:!0});return(0,l.jsxs)("div",{className:"fixed inset-0 bg-black/50 flex flex-col items-center justify-center",style:{zIndex:1e5},onClick:e=>e.target===e.currentTarget&&t(),onTouchEnd:e=>e.target===e.currentTarget&&t(),children:[(0,l.jsxs)("div",{...d,className:"bg-white rounded-3xl w-[80%] max-w-[400px] p-6 relative",style:{height:"80vh"},onClick:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{onClick:t,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-600 p-2",children:(0,l.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,l.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})}),0===s?(0,l.jsx)("div",{className:"flex flex-col items-center justify-center h-full",children:(0,l.jsx)(n.default,{src:(0,i.L)("/image/intro0.png"),alt:"Page 1",width:300,height:400})}):(0,l.jsxs)("div",{className:"h-full",children:[(0,l.jsxs)("div",{className:"flex items-start mb-8 mt-6",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold mr-4 text-white",children:"1"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-md font-bold mb-1 text-black",children:"绘制你的专属图腾或文字"}),(0,l.jsx)("div",{className:"text-xs text-gray-600",children:"DRAW ANY PICTURE OR TEXT"})]})]}),(0,l.jsx)("div",{className:"mb-8 flex justify-center",children:(0,l.jsx)(n.default,{src:(0,i.L)("/image/intro1.png"),alt:"Loading",width:200,height:100})}),(0,l.jsxs)("div",{className:"flex items-start mb-8",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold mr-4 text-white",children:"2"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text- font-bold mb-1 text-black",children:"完成创作后上传至觉醒石碑"}),(0,l.jsx)("div",{className:"text-xs text-gray-600",children:"UPLOAD WHEN FINISHED"})]})]}),(0,l.jsx)("div",{className:"mb-1 flex justify-center",children:(0,l.jsx)(n.default,{src:(0,i.L)("/image/intro2.png"),alt:"Loading",width:150,height:100})})]})]}),(0,l.jsxs)("div",{className:"flex justify-center mt-4",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full mx-1 ".concat(0===s?"bg-green-500":"bg-white")}),(0,l.jsx)("div",{className:"w-3 h-3 rounded-full mx-1 ".concat(1===s?"bg-green-500":"bg-white")})]})]})}},2344:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var l=s(5155),r=s(6766),a=s(7621),n=s(2148),i=s(2522);function c(e){let{onClose:t,imageUrl:s,userId:a}=e,n=a.padStart(8,"0");return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"w-[100%] max-w-sm rounded-3xl flex flex-col items-center py-12 px-14 relative",children:[(0,l.jsx)("h2",{className:"text-white text-xl font-bold",children:"你的专属图腾已传输至"}),(0,l.jsx)("h2",{className:"text-white text-xl font-bold mb-2",children:"觉醒石碑"}),(0,l.jsxs)("div",{className:"bg-white w-full aspect-[3/5] rounded-xl mb-3 overflow-hidden flex flex-col items-center justify-center shadow-[0_0_10px_5px_rgba(0,128,0,0.7)]",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-[#CCCCCC] mb-2 mt-4",children:"THE3.STUDIO"}),(0,l.jsx)(r.default,{src:s,alt:"Uploaded Image",width:300,height:400,className:"w-full h-full object-contain"}),(0,l.jsxs)("h1",{className:"text-md font-bold text-[#CCCCCC] mb-2 mt-1",children:["「\xc6V觉醒者编号」：#",n]})]}),(0,l.jsx)("button",{onClick:t,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center",children:(0,l.jsx)(r.default,{src:"/icon/close.svg",alt:"Close",width:24,height:24})})]})})}var o=s(2115);function d(){let[e,t]=(0,o.useState)(!1),[s,d]=(0,o.useState)(!0),[u,h]=(0,o.useState)(!0),[x,m]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1),[w,v]=(0,o.useState)(!1),[b,p]=(0,o.useState)(null),[j,N]=(0,o.useState)(!1),[E,y]=(0,o.useState)(null),[S,C]=(0,o.useState)(null);(0,o.useLayoutEffect)(()=>{t(!0);let e=new URLSearchParams(window.location.search).get("userId");C(e),e?console.log("pass"):(console.log("signin"),window.location.href="http://www.the3dio.cn/awakening")},[]),(0,o.useEffect)(()=>{let e=setTimeout(()=>{d(!1)},2e3);return()=>clearTimeout(e)},[]),(0,o.useEffect)(()=>{let e=e=>{e.preventDefault()},t=e=>{e.preventDefault()};return window.addEventListener("wheel",e,{passive:!1}),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("wheel",e),window.removeEventListener("touchmove",t)}},[]);let T=async()=>{if(!f)return;let e=document.querySelector("canvas");if(!e)return;v(!0),p(null);let t=new Date().toISOString().replace(/[-:.]/g,"");try{let s=await new Promise(t=>{e.toBlob(e=>{t(e)},"image/png")});if(!S)throw Error("用户未登录");let l=new FormData,r=new FormData,a="drawing_".concat(S,"_").concat(t,".png");l.append("image",s,a),r.append("userId",S),r.append("imageName",a),r.append("fileSize",s.size.toString());let n=await fetch("/api/upload",{method:"POST",body:l}),i=await n.json();if(!n.ok)throw Error(i.error||"图片上传失败");y("/api/upload/".concat(a)),N(!0);let c=await fetch("http://www.the3dio.cn/api/upload",{method:"POST",body:r}),o=await c.json();if(!c.ok)throw Error(o.error||"元数据上传失败");k(),g(!1),m(!1),v(!1),p(null)}catch(e){console.error("上传失败:",e),p(e instanceof Error?e.message:"上传失败，请重试")}},k=()=>{let e=document.querySelector("canvas");if(e){let t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),g(!1))}};return e?s?(0,l.jsx)(a.A,{}):(0,l.jsxs)("main",{className:"relative h-[100vh] md:h-[100vh] lg:h-[100vh] xl:h-[100vh] 2xl:h-[100vh] bg-white overflow-hidden",children:[(0,l.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#00FF00] via-[#00FF00]/50 to-white p-4",children:[(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsx)("button",{className:"text-black p-2 hover:bg-[#E8FFE8] rounded-full transition-colors touch-none",onClick:()=>h(!0),onTouchStart:e=>{e.preventDefault(),h(!0)},children:(0,l.jsx)(r.default,{src:"/icon/q.svg",alt:"Help",width:30,height:30})})}),(0,l.jsx)("div",{className:"flex-1 flex items-start justify-center",children:(0,l.jsxs)("div",{className:"relative h-[70vh] aspect-[3/4.5] bg-white rounded-3xl shadow-lg overflow-hidden",children:[(0,l.jsx)("h1",{className:"absolute top-4 left-1/2 -translate-x-1/2 text-2xl font-bold text-gray-300",children:"THE3.STUDIO"}),(0,l.jsx)("button",{onClick:()=>{f&&(m(!0),setTimeout(()=>m(!1),100),k())},onTouchStart:e=>{e.preventDefault(),f&&(m(!0),setTimeout(()=>m(!1),100),k())},className:"absolute top-4 right-4 p-2 rounded-full transition-colors touch-none ".concat(f?"bg-[#E8FFE8] hover:bg-[#E0FFE0] cursor-pointer active:bg-[#D0FFD0]":"bg-gray-100 cursor-not-allowed opacity-50"),disabled:!f,children:(0,l.jsx)(r.default,{src:"/icon/eraser.svg",alt:"Eraser",width:20,height:20,className:f?"":"opacity-50"})}),(0,l.jsx)("div",{className:"absolute bottom-0 w-full aspect-[3/4]",children:(0,l.jsx)(i.A,{isEraserEnabled:x,onDrawingChange:g,showInstructions:u,onUploadSuccess:e=>{N(!0),y(e)},onUploadError:e=>p(e)})})]})}),(0,l.jsxs)("div",{className:"h-[17vh] flex flex-col items-center justify-start mt-2 space-y-2",children:[b&&(0,l.jsx)("p",{className:"text-red-500 text-sm",children:b}),(0,l.jsx)("button",{className:"bg-[#00FF00] text-black font-bold py-4 px-24 rounded-full text-xl shadow-lg mx-auto transition-all ".concat(w||!f||u?"opacity-50 cursor-not-allowed":"hover:bg-[#00FF00]/90 active:bg-[#00FF00]/80"),onClick:T,disabled:w||!f||u,children:w?"UPLOADING...":"UPLOAD"})]})]}),u&&(0,l.jsx)(n.A,{onClose:()=>{h(!1)}}),j&&E&&(0,l.jsx)(c,{onClose:()=>{N(!1),k(),g(!1)},imageUrl:E,userId:S?S.padStart(8,"0"):"00000000"})]}):null}},2522:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var l=s(5155),r=s(2115);function a(e){let{isEraserEnabled:t,onDrawingChange:a,showInstructions:n}=e,i=(0,r.useRef)(null),c=(0,r.useRef)(null),o=(0,r.useRef)(null),d=(0,r.useRef)(!1),u=(0,r.useRef)(null),h=(0,r.useRef)(n);return(0,r.useEffect)(()=>{h.current=n},[n]),(0,r.useEffect)(()=>{if(i.current)return(async()=>{c.current=new(await s.e(588).then(s.t.bind(s,544,23))).default(e=>{e.setup=()=>{let t=i.current;if(!t)return;let s=e.createCanvas(t.clientWidth,t.clientHeight);s.parent(t),o.current=s.elt},e.draw=()=>{let s=e.touches.length>0,l=e.mouseIsPressed&&e.mouseButton===e.LEFT;!h.current&&(s||l)?t?(e.erase(),e.ellipse(e.mouseX,e.mouseY,20,20),e.noErase()):(e.stroke(0,255,0),e.strokeWeight(50),e.line(e.mouseX,e.mouseY,e.pmouseX,e.pmouseY),e.mouseX>=0&&e.mouseX<=e.width&&e.mouseY>=0&&e.mouseY<=e.height&&(null==a||a(!0),d.current=!0)):console.log("showInstructionsRef.current",h.current)},e.mouseWheel=()=>!1,e.mouseDragged=()=>{t||(null==a||a(!0),d.current=!0)},e.touchStarted=()=>{t||(null==a||a(!0),d.current=!0)},u.current=()=>{d.current=!1,null==a||a(!1)}})})(),()=>{c.current&&c.current.remove()}},[a,t,n]),(0,r.useEffect)(()=>{t&&u.current&&u.current()},[t]),(0,l.jsx)("div",{ref:i,className:"w-full h-full bg-white"})}let n=(0,s(5028).default)(()=>Promise.resolve(a),{ssr:!1})},4525:(e,t,s)=>{Promise.resolve().then(s.bind(s,2344))},6126:(e,t,s)=>{"use strict";s.d(t,{L:()=>n});var l,r=s(9509);let a=void 0!==r&&null!==(l=r.env.NEXT_PUBLIC_BASE_PATH)&&void 0!==l?l:"";function n(e){return e.startsWith("http")?e:"".concat(a).concat(e)}},7621:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var l=s(5155),r=s(6766),a=s(6126);let n=()=>(0,l.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-[#00FF00] text-black",children:[(0,l.jsx)("div",{className:"relative w-full aspect-square max-w-[65%] max-h-[65%] ",children:(0,l.jsx)(r.default,{src:(0,a.L)("/image/loading.png"),alt:"Loading",fill:!0,className:"object-contain",priority:!0})}),(0,l.jsxs)("div",{className:"absolute bottom-8 text-center",children:[(0,l.jsx)("div",{className:"text-sm mb-2",children:"INTERACTIVE DESIGN BY"}),(0,l.jsx)("div",{className:"text-xl font-bold",children:"THE3.STUDIO"})]})]})}},e=>{var t=t=>e(e.s=t);e.O(0,[121,441,684,358],()=>t(4525)),_N_E=e.O()}]);