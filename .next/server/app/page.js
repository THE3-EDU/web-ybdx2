(()=>{var e={};e.id=974,e.ids=[974],e.modules={40:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(687),i=s(3210),l=s(5992),n=s(474),a=s(5344);let o=({onClose:e})=>{let[t,s]=(0,i.useState)(0),o=e=>{"LEFT"===e?s(e=>(e+1)%2):"RIGHT"===e&&s(e=>(e-1+2)%2)},d=(0,l.uh)({onSwipedLeft:()=>o("LEFT"),onSwipedRight:()=>o("RIGHT"),preventScrollOnSwipe:!0,trackMouse:!0});return(0,r.jsxs)("div",{className:"fixed inset-0 bg-black/50 flex flex-col items-center justify-center",style:{zIndex:1e5},onClick:t=>t.target===t.currentTarget&&e(),onTouchEnd:t=>t.target===t.currentTarget&&e(),children:[(0,r.jsxs)("div",{...d,className:"bg-white rounded-3xl w-[80%] max-w-[400px] p-6 relative",style:{height:"80vh"},onClick:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:e,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-600 p-2",children:(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,r.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})}),0===t?(0,r.jsx)("div",{className:"flex flex-col items-center justify-center h-full min-h-0",children:(0,r.jsx)(n.default,{src:(0,a.L)("/image/intro0.png"),alt:"Page 1",width:300,height:400,unoptimized:!0})}):(0,r.jsxs)("div",{className:"h-full overflow-y-auto min-h-0",children:[(0,r.jsxs)("div",{className:"flex items-start mb-8 mt-6",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold mr-4 text-white",children:"1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-md font-bold mb-1 text-black",children:"绘制你的专属图腾或文字"}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"DRAW ANY PICTURE OR TEXT"})]})]}),(0,r.jsx)("div",{className:"mb-8 flex justify-center",children:(0,r.jsx)(n.default,{src:(0,a.L)("/image/intro1.png"),alt:"Loading",width:200,height:100,unoptimized:!0})}),(0,r.jsxs)("div",{className:"flex items-start mb-8",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold mr-4 text-white",children:"2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text- font-bold mb-1 text-black",children:"完成创作后上传至觉醒石碑"}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:"UPLOAD WHEN FINISHED"})]})]}),(0,r.jsx)("div",{className:"mb-1 flex justify-center",children:(0,r.jsx)(n.default,{src:(0,a.L)("/image/intro2.png"),alt:"Loading",width:150,height:100,unoptimized:!0})})]})]}),(0,r.jsxs)("div",{className:"flex justify-center mt-4",children:[(0,r.jsx)("div",{className:`w-3 h-3 rounded-full mx-1 ${0===t?"bg-green-500":"bg-white"}`}),(0,r.jsx)("div",{className:`w-3 h-3 rounded-full mx-1 ${1===t?"bg-green-500":"bg-white"}`})]})]})}},138:()=>{},597:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/zhengyali/Documents/the3projects/web-ybdx2/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/zhengyali/Documents/the3projects/web-ybdx2/app/page.tsx","default")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1628:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6444,23)),Promise.resolve().then(s.t.bind(s,6042,23)),Promise.resolve().then(s.t.bind(s,8170,23)),Promise.resolve().then(s.t.bind(s,9477,23)),Promise.resolve().then(s.t.bind(s,9345,23)),Promise.resolve().then(s.t.bind(s,2089,23)),Promise.resolve().then(s.t.bind(s,6577,23)),Promise.resolve().then(s.t.bind(s,1307,23))},1755:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(687),i=s(474),l=s(5344);let n=()=>(0,r.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-[#00FF00] text-black",children:[(0,r.jsx)("div",{className:"relative w-full aspect-square max-w-[65%] max-h-[65%] ",children:(0,r.jsx)(i.default,{src:(0,l.L)("/image/loading.png"),alt:"Loading",fill:!0,className:"object-contain",priority:!0,unoptimized:!0})}),(0,r.jsxs)("div",{className:"absolute bottom-8 text-center",children:[(0,r.jsx)("div",{className:"text-sm mb-2",children:"INTERACTIVE DESIGN BY"}),(0,r.jsx)("div",{className:"text-xl font-bold",children:"THE3.STUDIO"})]})]})},2067:(e,t,s)=>{Promise.resolve().then(s.bind(s,9910))},2704:()=>{},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},5344:(e,t,s)=>{"use strict";s.d(t,{L:()=>i});let r="undefined"!=typeof process?process.env.NEXT_PUBLIC_BASE_PATH??"":"";function i(e){return e.startsWith("http")?e:`${r}${e}`}},5627:(e,t,s)=>{Promise.resolve().then(s.bind(s,597))},5634:()=>{},6055:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(1658);let i=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},8014:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>o});var r=s(7413),i=s(4626),l=s.n(i),n=s(4566),a=s.n(n);s(2704);let o={title:"森林觉醒派对",description:"by THE3.Studio"};function d({children:e}){return(0,r.jsx)("html",{lang:"en",suppressHydrationWarning:!0,children:(0,r.jsx)("body",{className:`${l().variable} ${a().variable} antialiased`,suppressHydrationWarning:!0,children:e})})}},8060:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6346,23)),Promise.resolve().then(s.t.bind(s,7924,23)),Promise.resolve().then(s.t.bind(s,5656,23)),Promise.resolve().then(s.t.bind(s,99,23)),Promise.resolve().then(s.t.bind(s,8243,23)),Promise.resolve().then(s.t.bind(s,8827,23)),Promise.resolve().then(s.t.bind(s,2763,23)),Promise.resolve().then(s.t.bind(s,7173,23))},8252:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,pages:()=>c,routeModule:()=>u,tree:()=>d});var r=s(5239),i=s(8088),l=s(8170),n=s.n(l),a=s(893),o={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>a[e]);s.d(t,o);let d={children:["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,597)),"/Users/zhengyali/Documents/the3projects/web-ybdx2/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,8014)),"/Users/zhengyali/Documents/the3projects/web-ybdx2/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/zhengyali/Documents/the3projects/web-ybdx2/app/page.tsx"],h={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9202:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(687),i=s(3210);function l({isEraserEnabled:e,onDrawingChange:t,showInstructions:s}){let l=(0,i.useRef)(null);return(0,i.useRef)(null),(0,i.useRef)(null),(0,i.useRef)(!1),(0,i.useRef)(null),(0,i.useRef)(s),(0,r.jsx)("div",{ref:l,className:"w-full h-full bg-white"})}let n=(0,s(36).default)(()=>Promise.resolve(l),{ssr:!1})},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9910:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(687),i=s(474),l=s(1755),n=s(40),a=s(9202),o=s(5344);function d({onClose:e,imageUrl:t,userId:s}){let l=s.padStart(8,"0");return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"w-[100%] max-w-sm rounded-3xl flex flex-col items-center py-12 px-14 relative",children:[(0,r.jsx)("h2",{className:"text-white text-xl font-bold",children:"你的专属图腾已传输至"}),(0,r.jsx)("h2",{className:"text-white text-xl font-bold mb-2",children:"觉醒石碑"}),(0,r.jsxs)("div",{className:"bg-white w-full aspect-[3/5] rounded-xl mb-3 overflow-hidden flex flex-col items-center justify-center shadow-[0_0_10px_5px_rgba(0,128,0,0.7)]",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-[#CCCCCC] mb-2 mt-4",children:"THE3.STUDIO"}),(0,r.jsx)(i.default,{src:t,alt:"Uploaded Image",width:300,height:400,className:"w-full h-full object-contain"}),(0,r.jsxs)("h1",{className:"text-md font-bold text-[#CCCCCC] mb-2 mt-1",children:["「\xc6V觉醒者编号」：#",l]})]}),(0,r.jsx)("button",{onClick:e,className:"w-16 h-16 rounded-full bg-white flex items-center justify-center",children:(0,r.jsx)(i.default,{src:(0,o.L)("/icon/close.svg"),alt:"Close",width:24,height:24})})]})})}var c=s(3210);function h(){let[e,t]=(0,c.useState)(!1),[s,o]=(0,c.useState)(!0),[h,u]=(0,c.useState)(!0),[x,m]=(0,c.useState)(!1),[p,f]=(0,c.useState)(!1),[b,v]=(0,c.useState)(!1),[g,j]=(0,c.useState)(null),[w,y]=(0,c.useState)(!1),[N,P]=(0,c.useState)(null),[E,S]=(0,c.useState)(null),C=async()=>{if(!p)return;let e=document.querySelector("canvas");if(!e)return;v(!0),j(null);let t=new Date().toISOString().replace(/[-:.]/g,"");try{let s=await new Promise(t=>{e.toBlob(e=>{t(e)},"image/png")});if(!E)throw Error("用户未登录");let r=new FormData,i=new FormData,l=`drawing_${E}_${t}.png`;r.append("image",s,l),i.append("userId",E),i.append("imageName",l),i.append("fileSize",s.size.toString());let n=await fetch("/api/upload",{method:"POST",body:r}),a=await n.json();if(!n.ok)throw Error(a.error||"图片上传失败");P(`/api/upload/${l}`),y(!0);let o=await fetch("http://www.the3dio.cn/api/upload",{method:"POST",body:i}),d=await o.json();if(!o.ok)throw Error(d.error||"元数据上传失败");T(),f(!1),m(!1),v(!1),j(null)}catch(e){console.error("上传失败:",e),j(e instanceof Error?e.message:"上传失败，请重试")}},T=()=>{let e=document.querySelector("canvas");if(e){let t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),f(!1))}};return e?s?(0,r.jsx)(l.A,{}):(0,r.jsxs)("main",{className:"relative h-[100vh] md:h-[100vh] lg:h-[100vh] xl:h-[100vh] 2xl:h-[100vh] bg-white overflow-hidden",children:[(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#00FF00] via-[#00FF00]/50 to-white p-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("button",{className:"text-black p-2 hover:bg-[#E8FFE8] rounded-full transition-colors touch-none",onClick:()=>u(!0),onTouchStart:e=>{e.preventDefault(),u(!0)},children:(0,r.jsx)(i.default,{src:"/icon/q.svg",alt:"Help",width:30,height:30})})}),(0,r.jsx)("div",{className:"flex-1 flex items-start justify-center",children:(0,r.jsxs)("div",{className:"relative h-[70vh] aspect-[3/4.5] bg-white rounded-3xl shadow-lg overflow-hidden",children:[(0,r.jsx)("h1",{className:"absolute top-4 left-1/2 -translate-x-1/2 text-2xl font-bold text-gray-300",children:"THE3.STUDIO"}),(0,r.jsx)("button",{onClick:()=>{p&&(m(!0),setTimeout(()=>m(!1),100),T())},onTouchStart:e=>{e.preventDefault(),p&&(m(!0),setTimeout(()=>m(!1),100),T())},className:`absolute top-4 right-4 p-2 rounded-full transition-colors touch-none ${p?"bg-[#E8FFE8] hover:bg-[#E0FFE0] cursor-pointer active:bg-[#D0FFD0]":"bg-gray-100 cursor-not-allowed opacity-50"}`,disabled:!p,children:(0,r.jsx)(i.default,{src:"/icon/eraser.svg",alt:"Eraser",width:20,height:20,className:p?"":"opacity-50"})}),(0,r.jsx)("div",{className:"absolute bottom-0 w-full aspect-[3/4]",children:(0,r.jsx)(a.A,{isEraserEnabled:x,onDrawingChange:f,showInstructions:h,onUploadSuccess:e=>{y(!0),P(e)},onUploadError:e=>j(e)})})]})}),(0,r.jsxs)("div",{className:"h-[17vh] flex flex-col items-center justify-start mt-2 space-y-2",children:[g&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:g}),(0,r.jsx)("button",{className:`bg-[#00FF00] text-black font-bold py-4 px-24 rounded-full text-xl shadow-lg mx-auto transition-all ${b||!p||h?"opacity-50 cursor-not-allowed":"hover:bg-[#00FF00]/90 active:bg-[#00FF00]/80"}`,onClick:C,disabled:b||!p||h,children:b?"UPLOADING...":"UPLOAD"})]})]}),h&&(0,r.jsx)(n.A,{onClose:()=>{u(!1)}}),w&&N&&(0,r.jsx)(d,{onClose:()=>{y(!1),T(),f(!1)},imageUrl:N,userId:E?E.padStart(8,"0"):"00000000"})]}):null}}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,189,756],()=>s(8252));module.exports=r})();